{
  "version": 3,
  "sources": ["../../../src/pages/notifications.ts"],
  "sourcesContent": ["import { getNotifications } from \"../api/getNotifications\"\nimport { getSmiles } from \"../api/getSmiles\"\nimport { extLogger } from \"../logger\"\nimport { settings } from \"../storage\"\nconst log = new extLogger(\"pages/notifications.ts\")\n\nexport default async function members() {\n\tif (!settings.showRatingsInNotifications) return\n\n\tlet parseTimeout: number | null = null\n\n\t// \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0441\u043C\u0430\u0439\u043B\u044B \u043E\u0434\u0438\u043D \u0440\u0430\u0437\n\tconst smilesList = await getSmiles()\n\tconst smilesMap = new Map(smilesList?.smiles.map(s => [String(s.id), s.filename]))\n\n\tasync function parse() {\n\t\tconst currentPageElement = document.querySelector(\n\t\t\t\"#pagination-vue .pagination-vue-item.checked\"\n\t\t)\n\t\tconst currentPage = currentPageElement ? parseInt(currentPageElement.textContent || \"1\") : 1\n\n\t\tconst notifications = await getNotifications({ page: currentPage })\n\n\t\tconst items = document.querySelectorAll<HTMLElement>(\".notices-body__items-item\")\n\n\t\titems.forEach((item, i) => {\n\t\t\tconst n = notifications[i]\n\t\t\tif (n?.type !== \"forum_post_liked\" || !n.smile_id) return\n\n\t\t\tconst filename = smilesMap.get(String(n.smile_id))\n\t\t\tif (!filename) return\n\n\t\t\tif (item.querySelector(\"img[data-smile]\")) return\n\n\t\t\tconst img = document.createElement(\"img\")\n\t\t\timg.src = `/img/forum/emoticons/${filename}`\n\t\t\timg.alt = \"smile\"\n\t\t\timg.dataset.smile = \"true\"\n\t\t\titem.appendChild(img)\n\t\t})\n\t}\n\n\tconst noticesContainer = document.querySelector(\".notices-body__items\")\n\tif (noticesContainer) {\n\t\tconst observer = new MutationObserver(mutations => {\n\t\t\tlet hasNewItems = false\n\n\t\t\tfor (const mutation of mutations) {\n\t\t\t\tfor (const node of Array.from(mutation.addedNodes)) {\n\t\t\t\t\tif (!(node instanceof HTMLElement)) continue\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tnode.id === \"pagination-vue\" ||\n\t\t\t\t\t\tnode.closest(\"#pagination-vue\") ||\n\t\t\t\t\t\tnode.tagName === \"IMG\"\n\t\t\t\t\t) {\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.classList.contains(\"notices-body__items-item\")) {\n\t\t\t\t\t\thasNewItems = true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (hasNewItems) {\n\t\t\t\tif (parseTimeout) clearTimeout(parseTimeout)\n\t\t\t\tparseTimeout = window.setTimeout(() => {\n\t\t\t\t\tparse()\n\t\t\t\t\tparseTimeout = null\n\t\t\t\t}, 1000)\n\t\t\t}\n\t\t})\n\n\t\tobserver.observe(noticesContainer, { childList: true, subtree: true })\n\t}\n\n\tawait parse()\n}\n"],
  "mappings": ";;;;;;;;;;;;;AAIA,IAAM,MAAM,IAAI,UAAU,wBAAwB;AAElD,eAAO,UAAiC;AACvC,MAAI,CAAC,SAAS,2BAA4B;AAE1C,MAAI,eAA8B;AAGlC,QAAM,aAAa,MAAM,UAAU;AACnC,QAAM,YAAY,IAAI,IAAI,YAAY,OAAO,IAAI,OAAK,CAAC,OAAO,EAAE,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;AAEjF,iBAAe,QAAQ;AACtB,UAAM,qBAAqB,SAAS;AAAA,MACnC;AAAA,IACD;AACA,UAAM,cAAc,qBAAqB,SAAS,mBAAmB,eAAe,GAAG,IAAI;AAE3F,UAAM,gBAAgB,MAAM,iBAAiB,EAAE,MAAM,YAAY,CAAC;AAElE,UAAM,QAAQ,SAAS,iBAA8B,2BAA2B;AAEhF,UAAM,QAAQ,CAAC,MAAM,MAAM;AAC1B,YAAM,IAAI,cAAc,CAAC;AACzB,UAAI,GAAG,SAAS,sBAAsB,CAAC,EAAE,SAAU;AAEnD,YAAM,WAAW,UAAU,IAAI,OAAO,EAAE,QAAQ,CAAC;AACjD,UAAI,CAAC,SAAU;AAEf,UAAI,KAAK,cAAc,iBAAiB,EAAG;AAE3C,YAAM,MAAM,SAAS,cAAc,KAAK;AACxC,UAAI,MAAM,wBAAwB,QAAQ;AAC1C,UAAI,MAAM;AACV,UAAI,QAAQ,QAAQ;AACpB,WAAK,YAAY,GAAG;AAAA,IACrB,CAAC;AAAA,EACF;AAEA,QAAM,mBAAmB,SAAS,cAAc,sBAAsB;AACtE,MAAI,kBAAkB;AACrB,UAAM,WAAW,IAAI,iBAAiB,eAAa;AAClD,UAAI,cAAc;AAElB,iBAAW,YAAY,WAAW;AACjC,mBAAW,QAAQ,MAAM,KAAK,SAAS,UAAU,GAAG;AACnD,cAAI,EAAE,gBAAgB,aAAc;AAEpC,cACC,KAAK,OAAO,oBACZ,KAAK,QAAQ,iBAAiB,KAC9B,KAAK,YAAY,OAChB;AACD;AAAA,UACD;AAEA,cAAI,KAAK,UAAU,SAAS,0BAA0B,GAAG;AACxD,0BAAc;AAAA,UACf;AAAA,QACD;AAAA,MACD;AAEA,UAAI,aAAa;AAChB,YAAI,aAAc,cAAa,YAAY;AAC3C,uBAAe,OAAO,WAAW,MAAM;AACtC,gBAAM;AACN,yBAAe;AAAA,QAChB,GAAG,GAAI;AAAA,MACR;AAAA,IACD,CAAC;AAED,aAAS,QAAQ,kBAAkB,EAAE,WAAW,MAAM,SAAS,KAAK,CAAC;AAAA,EACtE;AAEA,QAAM,MAAM;AACb;",
  "names": []
}
